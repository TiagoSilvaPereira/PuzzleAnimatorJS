var puzzleAnimator={img:null,canvas:null,canvasContext:null,pieces:[],originalPieces:[],pieceWidth:0,pieceHeight:0,puzzleWidth:0,puzzleHeight:0,currentFrame:0,maxFrames:0,originalImageFrame:0,paused:!1,init:function(a){this.options=a,this.options.speed=a.speed||100,this.currentFrame=a.currentFrame||0,this.maxFrames=a.maxFrames||1,this.originalImageFrame=a.originalImageFrame||1,this.paused=a.paused||!1,this.makeImage()},makeImage:function(){this.img=new Image,this.img.addEventListener("load",this.imageLoaded.bind(this),!1),this.img.src=this.options.img},imageLoaded:function(){this.pieceWidth=Math.floor(this.img.width/this.options.difficulty),this.pieceHeight=Math.floor(this.img.height/this.options.difficulty),this.puzzleWidth=this.pieceWidth*this.options.difficulty,this.puzzleHeight=this.pieceHeight*this.options.difficulty,this.makeCanvas(),this.initPuzzle()},makeCanvas:function(){this.canvas=document.getElementById(this.options.canvasId),this.canvasContext=this.canvas.getContext("2d"),this.canvas.width=this.puzzleWidth,this.canvas.height=this.puzzleHeight},initPuzzle:function(){this.canvasContext.drawImage(this.img,0,0,this.puzzleWidth,this.puzzleHeight,0,0,this.puzzleWidth,this.puzzleHeight),this.buildPuzzlePieces()},buildPuzzlePieces:function(){var a,b,c=0,d=0;for(a=0;a<this.options.difficulty*this.options.difficulty;a++)b={},b.sx=c,b.sy=d,this.originalPieces.push(b),c+=this.pieceWidth,c>=this.puzzleWidth&&(c=0,d+=this.pieceHeight);this.pieces=this.originalPieces.slice(0),this.setupAnimation()},drawPieces:function(a){var b,c,d=0,e=0;for(this.canvasContext.clearRect(0,0,this.puzzleWidth,this.puzzleHeight),b=0;b<a.length;b++)c=a[b],c.xPos=d,c.yPos=e,this.canvasContext.drawImage(this.img,c.sx,c.sy,this.pieceWidth,this.pieceHeight,d,e,this.pieceWidth,this.pieceHeight),d+=this.pieceWidth,d>=this.puzzleWidth&&(d=0,e+=this.pieceHeight)},setupAnimation:function(){setInterval(function(){this.paused||(this.currentFrame=this.currentFrame<this.maxFrames?this.currentFrame+1:1,this.currentFrame!=this.originalImageFrame?this.shufflePuzzle():this.originalPuzzle())}.bind(this),this.options.speed)},originalPuzzle:function(){this.drawPieces(this.originalPieces)},shufflePuzzle:function(){this.pieces=this.shuffleArray(this.pieces),this.drawPieces(this.pieces)},shuffleArray:function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},getCurrentFrame:function(){return this.currentFrame},stop:function(){this.paused=!0},play:function(){this.paused=!1},toggle:function(){console.log(this.getCurrentFrame()),this.paused=!this.paused}};