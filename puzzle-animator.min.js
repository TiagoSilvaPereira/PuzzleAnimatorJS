var puzzleAnimator={img:null,canvas:null,canvasContext:null,pieces:[],originalPieces:[],pieceWidth:0,pieceHeight:0,puzzleWidth:0,puzzleHeight:0,interval:null,currentFrame:0,maxFrames:0,originalImageFrame:0,paused:!1,init:function(i){this.clearAnimationData(),this.options=i,this.options.speed=i.speed||100,this.currentFrame=i.currentFrame||0,this.maxFrames=i.maxFrames||1,this.originalImageFrame=i.originalImageFrame||1,this.paused=i.paused||!1,this.loadImage()},clearAnimationData:function(){this.interval&&clearInterval(this.interval),this.pieces&&(this.pieces=[]),this.originalPieces&&(this.originalPieces=[]),this.pieceWidth=0,this.pieceHeight=0,this.puzzleWidth=0,this.puzzleHeight=0},loadImage:function(i){this.img&&this.img.remove(),this.img=new Image,this.img.addEventListener("load",this.imageLoaded.bind(this),!1),this.img.src=this.options.img||i},imageLoaded:function(){this.pieceWidth=Math.floor(this.img.width/this.options.difficulty),this.pieceHeight=Math.floor(this.img.height/this.options.difficulty),this.puzzleWidth=this.pieceWidth*this.options.difficulty,this.puzzleHeight=this.pieceHeight*this.options.difficulty,this.makeCanvas(),this.initPuzzle()},makeCanvas:function(){this.canvas||(this.canvas=document.getElementById(this.options.canvasId)),this.canvasContext||(this.canvasContext=this.canvas.getContext("2d")),this.clearContext(),this.canvas.width=this.puzzleWidth,this.canvas.height=this.puzzleHeight},initPuzzle:function(){this.canvasContext.drawImage(this.img,0,0,this.puzzleWidth,this.puzzleHeight,0,0,this.puzzleWidth,this.puzzleHeight),this.buildPuzzlePieces()},buildPuzzlePieces:function(){var i,t,e=0,s=0;for(i=0;i<this.options.difficulty*this.options.difficulty;i++)t={},t.sx=e,t.sy=s,this.originalPieces.push(t),e+=this.pieceWidth,e>=this.puzzleWidth&&(e=0,s+=this.pieceHeight);this.pieces=this.originalPieces.slice(0),this.setupAnimation()},drawPieces:function(i){var t,e,s=0,h=0;for(this.clearContext(),t=0;t<i.length;t++)e=i[t],e.xPos=s,e.yPos=h,this.canvasContext.drawImage(this.img,e.sx,e.sy,this.pieceWidth,this.pieceHeight,s,h,this.pieceWidth,this.pieceHeight),this.canvasContext.strokeRect(s,h,this.pieceWidth,this.pieceHeight),s+=this.pieceWidth,s>=this.puzzleWidth&&(s=0,h+=this.pieceHeight)},clearContext:function(){this.canvasContext.clearRect(0,0,this.puzzleWidth,this.puzzleHeight)},setupAnimation:function(){this.interval=setInterval(function(){this.paused||(this.currentFrame=this.currentFrame<this.maxFrames?this.currentFrame+1:1,this.currentFrame!=this.originalImageFrame?this.shufflePuzzle():this.originalPuzzle())}.bind(this),this.options.speed)},originalPuzzle:function(){this.drawPieces(this.originalPieces)},shufflePuzzle:function(){this.pieces=this.shuffleArray(this.pieces),this.drawPieces(this.pieces)},shuffleArray:function(i){for(var t,e,s=i.length;s;t=parseInt(Math.random()*s),e=i[--s],i[s]=i[t],i[t]=e);return i},getCurrentFrame:function(){return this.currentFrame},stop:function(){this.paused=!0},play:function(){this.paused=!1},toggle:function(){this.paused=!this.paused},destroy:function(){this.interval&&(console.log("Destroy interval"),clearInterval(this.interval))}};